!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).JSONParser=t()}(this,(function(){"use strict";class e extends Error{constructor(e){super(`"${e.value}" is not valid JSON\nline: ${e.startLine}, column: ${e.startColumn}`),this.name="CompilationError"}}class t{constructor(){}formatStr(e){return e.substring(1,e.length-1).replace(/\\\\/g,"\\")}appendBoolean(e){return{type:"BOOLEAN",value:"TRUE_BOOLEAN"===e.type}}appendNullValue(e){return{type:"NULL_VALUE",value:null}}appendString(e){return{type:"STRING",value:this.formatStr(e.value)}}appendArray(e){return{type:"ARRAY",properties:[]}}appendObject(e){return{type:"OBJECT",properties:[]}}appendNumber(e){return{type:"NUMBER",value:Number(e.value)}}appendKey(e){return{type:"OBJECT_KEY",name:this.formatStr(e.value),properties:[]}}buildAST(t){const r={type:"JSON",properties:[]},p=[r];let s=null;for(let n=0;n<t.length;++n){const i=t[n],o=p[p.length-1];if("UNKNOWN"===i.type)throw new e(i);if("TRUE_BOOLEAN"===i.type||"FALSE_BOOLEAN"===i.type)o.properties.push(this.appendBoolean(i));else if("NULL"===i.type)o.properties.push(this.appendNullValue(i));else if("NUMBER"===i.type)o.properties.push(this.appendNumber(i));else if("STRING"===i.type)if("OBJECT"===o.type){const e=this.appendKey(i);o.properties.push(e),p.push(e)}else o.properties.push(this.appendString(i));else if("START_BRACKET"===i.type){const e=this.appendArray(i);o.properties.push(e),p.push(e)}else if("START_BRACE"===i.type){const e=this.appendObject(i);o.properties.push(e),p.push(e)}else if("END_BRACKET"===i.type){if("ARRAY"===o.type&&o.properties.length%2!=0)throw new e(s);if("ARRAY"!==o.type)throw new e(i);p.pop()}else if("END_BRACE"===i.type){if("OBJECT"===o.type&&o.properties.length%2!=0)throw new e(s);if("OBJECT_KEY"===o.type&&p.pop(),"OBJECT"!==p[p.length-1].type)throw new e(i);p.pop()}else if("COMA"===i.type){if("OBJECT_KEY"!==o.type&&"ARRAY"!==o.type)throw new e(i);"OBJECT_KEY"===o.type&&p.pop()}else if("COLON"===i.type&&"OBJECT_KEY"!==o.type)throw new e(i);if("WHITE_SPACE"!==i.type&&(s=i),r.properties.length>1)throw new e(i)}return r}}class r{constructor(e={}){this.tokens=e,this.defaultType="UNKNOWN"}setDefaultType(e){this.defaultType=e}getDefaultType(){return this.defaultType}getTokens(){return this.tokens}addToken(e,t){this.tokens[e]=t}matcher(e,t,r){r.lastIndex=0;const p=r.exec(e);return p&&0===p.index?{type:t,wordLength:p[0].length}:{type:this.defaultType,wordLength:1}}tokenize(e){const t=[],r=e.split(/(\n)/g);for(let p=0;p<r.length;++p){const s=r[p];for(let r=0;r<s.length;++r){const s=(p+1)*(r+1)-1;let n=null;for(const[t,r]of Object.entries(this.tokens))if(n=this.matcher(e.substring(s,e.length),t,r),n.type!==this.defaultType)break;t.push({type:n.type,value:e.substring(s,s+n.wordLength),startLine:p,startColumn:r,endLine:p,endColumn:r+n.wordLength-1}),r+=n.wordLength-1}}return t}}const p={STRING:/(['"])(?:\\\1|.)*?\1/,NUMBER:/\d+(?:.\d+)?/,WHITE_SPACE:/\s+/,COMA:/,/,COLON:/:/,TRUE_BOOLEAN:/true/,FALSE_BOOLEAN:/false/,NULL:/null/,START_BRACKET:/\[/,END_BRACKET:/\]/,START_BRACE:/\{/,END_BRACE:/\}/};const s=new class{constructor(){this.tokenizer=new r(p),this.astBuilder=new t}parse(e){const t=this.tokenizer.tokenize(e),r=this.astBuilder.buildAST(t);return this.parseASTBranch(r.properties[0])}parseASTBranch(e){return"OBJECT"===e.type?this.parseObject(e):"ARRAY"===e.type?this.parseArray(e):this.parsePrimitif(e)}parseArray(e){const t=[];for(const r of e.properties)t.push(this.parseASTBranch(r));return t}parseObject(e){const t={};for(const r of e.properties)t[r.name]=this.parseASTBranch(r.properties[0]);return t}parsePrimitif(e){return e.value}};return s.parse.bind(s)}));
//# sourceMappingURL=index.js.map
