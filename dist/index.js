!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).JSONParser=t()}(this,(function(){"use strict";class e{getErrorMessage(e){return`"${e.value}" is not valid JSON\nline: ${e.startLine}, column: ${e.startColumn}`}formatStr(e){return e.substring(1,e.length-1).replace(/\\\\/g,"\\")}appendBoolean(e){return{type:"BOOLEAN",value:"TRUE_BOOLEAN"===e.type}}appendNullValue(e){return{type:"NULL_VALUE",value:null}}appendString(e){return{type:"STRING",value:this.formatStr(e.value)}}appendArray(e){return{type:"ARRAY",properties:[]}}appendObject(e){return{type:"OBJECT",properties:[]}}appendNumber(e){return{type:"NUMBER",value:Number(e.value)}}appendKey(e){return{type:"OBJECT_KEY",name:this.formatStr(e.value),value:null}}buildAST(e){const t={type:"JSON",value:null},r=[t];let n=null;for(let t=0;t<e.length;++t){const s=e[t],p=r[r.length-1],a=e=>{if("value"in p){if(null!==p.value)throw new SyntaxError(this.getErrorMessage(s));p.value=e}else p.properties.push(e)};if("UNKNOWN"===s.type)throw new SyntaxError(this.getErrorMessage(s));if("TRUE_BOOLEAN"===s.type||"FALSE_BOOLEAN"===s.type)a(this.appendBoolean(s));else if("NULL"===s.type)a(this.appendNullValue(s));else if("NUMBER"===s.type)a(this.appendNumber(s));else if("STRING"===s.type)if("OBJECT"===p.type){const e=this.appendKey(s);a(e),r.push(e)}else a(this.appendString(s));else if("START_BRACKET"===s.type){const e=this.appendArray(s);a(e),r.push(e)}else if("START_BRACE"===s.type){const e=this.appendObject(s);a(e),r.push(e)}else if("END_BRACKET"===s.type){if("COMA"===n.type||"COLON"===n.type)throw new SyntaxError(this.getErrorMessage(n));if("ARRAY"!==p.type)throw new SyntaxError(this.getErrorMessage(s));r.pop()}else if("END_BRACE"===s.type){if("COMA"===n.type||"COLON"===n.type)throw new SyntaxError(this.getErrorMessage(n));if("OBJECT_KEY"===p.type&&r.pop(),"OBJECT"!==r[r.length-1].type)throw new SyntaxError(this.getErrorMessage(s));r.pop()}else if("COMA"===s.type){if("OBJECT_KEY"!==p.type&&"ARRAY"!==p.type)throw new SyntaxError(this.getErrorMessage(s));if("OBJECT_KEY"===p.type&&null===p.value)throw new SyntaxError(this.getErrorMessage(s));"OBJECT_KEY"===p.type&&r.pop()}else if("COLON"===s.type&&("OBJECT_KEY"!==p.type||null!==p.value))throw new SyntaxError(this.getErrorMessage(s));"WHITE_SPACE"!==s.type&&(n=s)}if(1!==r.length)throw new SyntaxError(this.getErrorMessage(n));return t}}class t{constructor(e={}){this.tokens=e,this.defaultType="UNKNOWN"}setDefaultType(e){this.defaultType=e}getDefaultType(){return this.defaultType}getTokens(){return this.tokens}addToken(e,t){this.tokens[e]=t}matcher(e,t,r){r.lastIndex=0;const n=r.exec(e);return n&&0===n.index?{type:t,wordLength:n[0].length}:{type:this.defaultType,wordLength:1}}tokenize(e){const t=[],r=e.split(/(\n)/g);for(let n=0;n<r.length;++n){const s=r[n];for(let r=0;r<s.length;++r){const s=(n+1)*(r+1)-1;let p=null;for(const[t,r]of Object.entries(this.tokens))if(p=this.matcher(e.substring(s,e.length),t,r),p.type!==this.defaultType)break;t.push({type:p.type,value:e.substring(s,s+p.wordLength),startLine:n,startColumn:r,endLine:n,endColumn:r+p.wordLength-1}),r+=p.wordLength-1}}return t}}const r={STRING:/(")(?:\\\1|.)*?\1/,NUMBER:/\d+(?:.\d+)?/,WHITE_SPACE:/\s+/,COMA:/,/,COLON:/:/,TRUE_BOOLEAN:/true/,FALSE_BOOLEAN:/false/,NULL:/null/,START_BRACKET:/\[/,END_BRACKET:/\]/,START_BRACE:/\{/,END_BRACE:/\}/};const n=new class{constructor(){this.tokenizer=new t(r),this.astBuilder=new e}parse(e){e=String(e);const t=this.tokenizer.tokenize(e),r=this.astBuilder.buildAST(t);return this.parseASTBranch(r.value)}parseASTBranch(e){return"OBJECT"===e.type?this.parseObject(e):"ARRAY"===e.type?this.parseArray(e):this.parsePrimitif(e)}parseArray(e){const t=[];for(const r of e.properties)t.push(this.parseASTBranch(r));return t}parseObject(e){const t={};for(const r of e.properties)t[r.name]=this.parseASTBranch(r.value);return t}parsePrimitif(e){return e.value}};return n.parse.bind(n)}));
//# sourceMappingURL=index.js.map
