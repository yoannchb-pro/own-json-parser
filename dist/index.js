!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).JSONParser=t()}(this,(function(){"use strict";class e{getErrorMessage(e){return`"${e.value}" is not valid JSON\nline: ${e.startLine}, column: ${e.startColumn}`}formatStr(e){const t=e.substring(1,e.length-1);return t.replace(/\\(.)/g,(function(e,t){return"n"===t?"\n":"r"===t?"\r":"t"===t?"\t":"b"===t?"\b":"f"===t?"\f":"v"===t?"\v":t}))}appendBoolean(e){return{type:"BOOLEAN",value:"TRUE_BOOLEAN"===e.type}}appendNullValue(e){return{type:"NULL_VALUE",value:null}}appendString(e){return{type:"STRING",value:this.formatStr(e.value)}}appendArray(e){return{type:"ARRAY",properties:[]}}appendObject(e){return{type:"OBJECT",properties:[]}}appendNumber(e){return{type:"NUMBER",value:Number(e.value)}}appendKey(e){return{type:"OBJECT_KEY",name:this.formatStr(e.value),value:null}}buildAST(e){const t={type:"JSON",value:null},r=[t];let n=null;for(let t=0;t<e.length;++t){const s=e[t],o=r[r.length-1],i=e=>{if("ARRAY"===o.type&&null!==n&&"START_BRACKET"!==n.type&&"COMA"!==n.type)throw new SyntaxError(this.getErrorMessage(n));if("OBJECT"===o.type&&"OBJECT_KEY"!==e.type)throw new SyntaxError(this.getErrorMessage(s));if("value"in o){if(null!==o.value)throw new SyntaxError(this.getErrorMessage(s));o.value=e}else o.properties.push(e)};if("TRUE_BOOLEAN"===s.type||"FALSE_BOOLEAN"===s.type)i(this.appendBoolean(s));else if("NULL"===s.type)i(this.appendNullValue(s));else if("NUMBER"===s.type)i(this.appendNumber(s));else if("STRING"===s.type)if("OBJECT"===o.type){const e=this.appendKey(s);i(e),r.push(e)}else i(this.appendString(s));else if("START_BRACKET"===s.type){const e=this.appendArray(s);i(e),r.push(e)}else if("START_BRACE"===s.type){const e=this.appendObject(s);i(e),r.push(e)}else if("END_BRACKET"===s.type){if("COMA"===(null==n?void 0:n.type)||"COLON"===(null==n?void 0:n.type))throw new SyntaxError(this.getErrorMessage(n));if("ARRAY"!==o.type)throw new SyntaxError(this.getErrorMessage(s));r.pop()}else if("END_BRACE"===s.type){if("COMA"===(null==n?void 0:n.type)||"COLON"===(null==n?void 0:n.type))throw new SyntaxError(this.getErrorMessage(n));if("OBJECT_KEY"===o.type&&r.pop(),"OBJECT"!==r[r.length-1].type)throw new SyntaxError(this.getErrorMessage(s));r.pop()}else if("COMA"===s.type){if("COMA"===(null==n?void 0:n.type)||"COLON"===(null==n?void 0:n.type))throw new SyntaxError(this.getErrorMessage(s));if("OBJECT_KEY"!==o.type&&"ARRAY"!==o.type)throw new SyntaxError(this.getErrorMessage(s));if("OBJECT_KEY"===o.type&&null===o.value)throw new SyntaxError(this.getErrorMessage(s));"OBJECT_KEY"===o.type&&r.pop()}else if("COLON"===s.type&&("STRING"!==(null==n?void 0:n.type)||"OBJECT_KEY"!==o.type||null!==o.value))throw new SyntaxError(this.getErrorMessage(s));"WHITE_SPACE"!==s.type&&(n=s)}if(1!==r.length)throw new SyntaxError(this.getErrorMessage(n));return t}}const t={defaultType:"UNKNOWN",concatDefaultType:!0};class r{constructor(e){if(!e||!e.tokens)throw new Error('Invalide options: "tokens" is required');this.options=Object.assign({},t,e)}getDefaultType(){return this.options.defaultType}getTokens(){return this.options.tokens}getTokensName(){return[...Object.keys(this.options.tokens),this.getDefaultType()]}matcher(e,t,r){r.lastIndex=0;const n=r.exec(e);return n?{type:t,value:n[0],groups:n.groups,index:n.index}:null}tokenize(e){var t,r,n,s,o;if("string"!=typeof e)return[];const i=[],l=this.getDefaultType(),p=this.options.concatDefaultType,a=this.options.tokens;for(let u=0;u<e.length;++u){const h=e.substring(u,e.length),E=e.substring(0,u),y={type:l,value:h.charAt(0),index:0};let c=y;const d=Object.entries(a).reverse();for(const[e,t]of d){const r=this.matcher(h,e,t);null!==r&&(0===r.index?c=r:this.options.prioritize&&c!==y&&c.value.length>r.index&&(c=y))}const g=c.value.split(/\n/g),f=null!==(r=null===(t=E.match(/\n/g))||void 0===t?void 0:t.length)&&void 0!==r?r:0,T=f+Math.max(g.length-1,0),O=null!==(o=null===(s=null===(n=E.split(/\n/g))||void 0===n?void 0:n[f])||void 0===s?void 0:s.length)&&void 0!==o?o:0,A=g[g.length-1].length+(f===T?O:0);let N={type:c.type,value:c.value,...c.groups?{groups:c.groups}:{},startLine:f,startColumn:O,endLine:T,endColumn:A};if(N=this.options.callback?this.options.callback(N,i):N,u+=c.value.length-1,null===N)continue;if(!this.options.authorizeAdditionalTokens&&!this.getTokensName().includes(N.type))throw new Error(`Unknown token type returned by the callback: "${N.type}" (If you want to allow other types please set authorizeAdditionalTokens to true)`);const S=N.type===l;if(p&&S&&0!==i.length&&i[i.length-1].type===l){const e=i[i.length-1];e.value+=N.value,e.endColumn=N.endColumn,e.endLine=N.endLine}else i.push(N)}return i}}r.BUILT_IN_RULES={WORD:/\w+/,NUMBER:/\d+(?:\.\d+)?/,ONE_LINE_COMMENT:/\/\/.*/,MULTIPLE_LINE_COMMENT:/\/\*[\s\S]*?\*\//,STRING:/("|'|`)(?<content>(?:\\\1|.)*?)\1/,DOUBLE_QUOTE_STRING:/(")(?<content>(?:\\\1|.)*?)\1/,SINGLE_QUOTE_STRING:/(')(?<content>(?:\\\1|.)*?)\1/,GRAVE_ACCENT_STRING:/(`)(?<content>(?:\\\1|.)*?)\1/,WHITE_SPACES:/\s+/,NEW_LINES:/\n+/};const n={STRING:/(")(?:\\\1|.)*?\1/,NUMBER:/\d+(?:\.\d+)?/,WHITE_SPACE:/\s+/,COMA:/,/,COLON:/:/,TRUE_BOOLEAN:/true/,FALSE_BOOLEAN:/false/,NULL:/null/,START_BRACKET:/\[/,END_BRACKET:/\]/,START_BRACE:/\{/,END_BRACE:/\}/};const s=new class{constructor(){this.astBuilder=new e,this.tokenizer=new r({tokens:n,callback:e=>{if("UNKNOWN"===e.type)throw new SyntaxError(this.astBuilder.getErrorMessage(e));return e}})}parse(e){e=String(e);const t=this.tokenizer.tokenize(e),r=this.astBuilder.buildAST(t);return this.parseASTBranch(r.value)}parseASTBranch(e){return"OBJECT"===e.type?this.parseObject(e):"ARRAY"===e.type?this.parseArray(e):this.parsePrimitif(e)}parseArray(e){const t=[];for(const r of e.properties)t.push(this.parseASTBranch(r));return t}parseObject(e){const t={};for(const r of e.properties)t[r.name]=this.parseASTBranch(r.value);return t}parsePrimitif(e){return e.value}};return s.parse.bind(s)}));
//# sourceMappingURL=index.js.map
