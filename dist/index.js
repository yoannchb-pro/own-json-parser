!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).JSONParser=t()}(this,(function(){"use strict";class e{getErrorMessage(e){return`"${e.value}" is not valid JSON\nline: ${e.startLine}, column: ${e.startColumn}`}formatStr(e){const t=e.substring(1,e.length-1);return t.replace(/\\(.)/g,(function(e,t){return"n"===t?"\n":"r"===t?"\r":"t"===t?"\t":"b"===t?"\b":"f"===t?"\f":"v"===t?"\v":t}))}appendBoolean(e){return{type:"BOOLEAN",value:"TRUE_BOOLEAN"===e.type}}appendNullValue(e){return{type:"NULL_VALUE",value:null}}appendString(e){return{type:"STRING",value:this.formatStr(e.value)}}appendArray(e){return{type:"ARRAY",properties:[]}}appendObject(e){return{type:"OBJECT",properties:[]}}appendNumber(e){return{type:"NUMBER",value:Number(e.value)}}appendKey(e){return{type:"OBJECT_KEY",name:this.formatStr(e.value),value:null}}buildAST(e){const t={type:"JSON",value:null},r=[t];let n=null;for(let t=0;t<e.length;++t){const s=e[t],o=r[r.length-1],p=e=>{if("value"in o){if(null!==o.value)throw new SyntaxError(this.getErrorMessage(s));o.value=e}else o.properties.push(e)};if("TRUE_BOOLEAN"===s.type||"FALSE_BOOLEAN"===s.type)p(this.appendBoolean(s));else if("NULL"===s.type)p(this.appendNullValue(s));else if("NUMBER"===s.type)p(this.appendNumber(s));else if("STRING"===s.type)if("OBJECT"===o.type){const e=this.appendKey(s);p(e),r.push(e)}else p(this.appendString(s));else if("START_BRACKET"===s.type){const e=this.appendArray(s);p(e),r.push(e)}else if("START_BRACE"===s.type){const e=this.appendObject(s);p(e),r.push(e)}else if("END_BRACKET"===s.type){if("COMA"===n.type||"COLON"===n.type)throw new SyntaxError(this.getErrorMessage(n));if("ARRAY"!==o.type)throw new SyntaxError(this.getErrorMessage(s));r.pop()}else if("END_BRACE"===s.type){if("COMA"===n.type||"COLON"===n.type)throw new SyntaxError(this.getErrorMessage(n));if("OBJECT_KEY"===o.type&&r.pop(),"OBJECT"!==r[r.length-1].type)throw new SyntaxError(this.getErrorMessage(s));r.pop()}else if("COMA"===s.type){if("OBJECT_KEY"!==o.type&&"ARRAY"!==o.type)throw new SyntaxError(this.getErrorMessage(s));if("OBJECT_KEY"===o.type&&null===o.value)throw new SyntaxError(this.getErrorMessage(s));"OBJECT_KEY"===o.type&&r.pop()}else if("COLON"===s.type&&("OBJECT_KEY"!==o.type||null!==o.value))throw new SyntaxError(this.getErrorMessage(s));"WHITE_SPACE"!==s.type&&(n=s)}if(1!==r.length)throw new SyntaxError(this.getErrorMessage(n));return t}}const t={defaultType:"UNKNOWN",concatDefaultType:!0,callback:e=>e};class r{constructor(e={}){this.options={},this.options=Object.assign({},t,e)}setDefaultType(e){this.options.defaultType=e}getDefaultType(){return this.options.defaultType}getTokens(){return this.options.tokens}addToken(e,t){this.options.tokens[e]=t}setCallback(e){this.options.callback=e}matcher(e,t,r){r.lastIndex=0;const n=r.exec(e);return n&&0===n.index?{type:t,wordLength:n[0].length}:{type:this.options.defaultType,wordLength:1}}tokenize(e){var t,r;const n=[],s=e.split(/\n/g);let o=0;for(let p=0;p<s.length;++p){const i=s[p];for(let s=0;s<i.length;++s){const i=s+o;let a=null;for(const[t,r]of Object.entries(this.options.tokens))if(a=this.matcher(e.substring(i,e.length),t,r),a.type!==this.options.defaultType)break;const l=e.substring(i,i+a.wordLength),u=null!==(r=null===(t=l.match(/\n/g))||void 0===t?void 0:t.length)&&void 0!==r?r:0,h=this.options.callback({type:a.type,value:l,startLine:p,startColumn:s,endLine:p+u,endColumn:s+a.wordLength-1});if(this.options.concatDefaultType&&h.type===this.options.defaultType&&0!==n.length&&n[n.length-1].type===this.options.defaultType){const e=n[n.length-1];e.value+=h.value,e.endColumn=h.endColumn,e.endLine=h.endLine}else n.push(h);s+=a.wordLength-1}o+=i.length+1}return n}}const n={STRING:/(")(?:\\\1|.)*?\1/,NUMBER:/\d+(?:.\d+)?/,WHITE_SPACE:/\s+/,COMA:/,/,COLON:/:/,TRUE_BOOLEAN:/true/,FALSE_BOOLEAN:/false/,NULL:/null/,START_BRACKET:/\[/,END_BRACKET:/\]/,START_BRACE:/\{/,END_BRACE:/\}/};const s=new class{constructor(){this.tokenizer=new r({tokens:n}),this.astBuilder=new e,this.tokenizer.setCallback((e=>{if("UNKNOWN"===e.type)throw new SyntaxError(this.astBuilder.getErrorMessage(e));return e}))}parse(e){e=String(e);const t=this.tokenizer.tokenize(e),r=this.astBuilder.buildAST(t);return this.parseASTBranch(r.value)}parseASTBranch(e){return"OBJECT"===e.type?this.parseObject(e):"ARRAY"===e.type?this.parseArray(e):this.parsePrimitif(e)}parseArray(e){const t=[];for(const r of e.properties)t.push(this.parseASTBranch(r));return t}parseObject(e){const t={};for(const r of e.properties)t[r.name]=this.parseASTBranch(r.value);return t}parsePrimitif(e){return e.value}};return s.parse.bind(s)}));
//# sourceMappingURL=index.js.map
